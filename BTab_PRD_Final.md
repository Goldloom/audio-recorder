# 📄 B탭(녹음 + 캡처 프로그램) 기능 개선 PRD  
## — 클립보드 기반 실시간 분할 + CSV 기반 일괄 분할

---

## 1️⃣ 프로젝트 개요

본 프로젝트는 **A탭(교육 플랫폼) + Tampermonkey 스크립트 + B탭(녹음/캡처 시스템)** 을 결합하여,  
강의 수강 기록(오디오 / 화면 캡처)을 더 정확하고 편리하게 자동화하는 것을 목표로 합니다.

이를 위해 B탭에는 아래 2개의 분리된 처리 모드를 제공합니다:

1. **제목감지 자동 분할모드 (클립보드 기반 실시간 분할 모드)**
2. **제목감지 일괄 분할모드 (CSV 기반 한번에 처리 모드)**

---

## 2️⃣ 시스템 목적

- 강의 구간을 자동으로 인식 및 분리
- 녹음 파일(webm) 자동 분리
- 캡처 이미지 기반 강의별 PDF 자동 생성
- 실시간 처리와 안정적 후처리 두 가지 방식 제공
- 사용자 개입 최소화

---

## 3️⃣ 기능 모드 정의

---

# ✅ 3-1. 제목감지 자동 분할모드  
## (클립보드 기반 실시간 분할 모드)

---

### ✔ 목적

이 모드는 **“클립보드 내용 변경”을 강의 변경 신호로 인식하여 실시간 분할하는 모드**입니다.

A탭(또는 Tampermonkey)이 강의가 변경될 때마다 생성하는  
예:  
```
114 - Ch 5 - 03. RAG 코드 구현하기
```
와 같은 문자열을 클립보드로 전달하면,

📌 B탭은 클립보드를 실시간 감시하여  
📌 값이 변경되는 순간 강의 변경으로 판단하고  
👉 즉시 녹음과 캡처를 분할 저장합니다.

---

### ✔ 동작 방식

1️⃣ A탭 / Tampermonkey  
- 강의 제목 변경 감지  
- 강의 식별 문자열 생성  
- 클립보드에 전달(자동 복사 또는 사용자 복사 기반)

2️⃣ B탭  
- 일정 주기(예: 1초)로 클립보드 감시  
- 이전 값과 비교  
- 값이 변경되면 강의 변경으로 판단

3️⃣ B탭 수행 작업  
- 기존 녹음(webm) 저장 후 종료  
- 새 녹음 자동 시작  
- 기존 캡처 그룹 저장  
- 새 캡처 세트 생성  

---

### ✔ 판단 기준

- DOM 감지 ❌  
- 네트워크 이벤트 ❌  
- 플레이어 내부 API ❌  

👉 **“클립보드 값 변화 = 강의 변경”** 이라는 단일 판단 로직

---

### ✔ 출력물

| 종류 | 내용 |
|------|------|
| 오디오 | 강의별 webm 파일 즉시 저장 |
| 캡처 | 강의별 이미지 분리 저장 |
| PDF | 필요 시 즉시 변환 가능 |

---

### ✔ 파일명 규칙

목차분석을 한 경우 목차분석한 파일명 그대로 사용
-클립보드 내용 중 lecture 이름만 동일하면 동일한 강의로 간주

목차분석을 안 한 경우 클립보드 문자열 그대로 사용

```
{donut} - {chapter} - {lecture}.webm
```

예:
```
114 - Ch 5 - 03. RAG 코드 구현하기.webm
```

chapter 없는 경우:
```
114 - 03. RAG 코드.webm
```

---

### ✔ UI 요구사항

```
[ 제목감지 자동 분할모드 (클립보드) ON / OFF ]

현재 감지된 강의: (클립보드 값)
최근 변경 감지 시각 표시
클립보드 권한 상태 표시
감시 정상 여부 표시
오류 시 경고 표시
```

---

### ✔ 장점

- Tampermonkey와 직접 연동 가능
- DOM 구조 변경에도 안전
- 네트워크 지연 영향 적음
- 실시간 자동 분할 가능
- 사용자 경험 매우 좋음

---

### ❗ 리스크 / 예외

- 브라우저의 클립보드 접근 정책 영향 가능
- 다른 앱이 클립보드를 덮어쓸 가능성 있음
- CSV 기반 처리 대비 안정성은 상대적으로 낮음

---

---

# ✅ 3-2. 제목감지 일괄 분할모드  
## (CSV 기반 한번에 처리 모드)

---

### ✔ 목적

이 모드는 실시간 처리보다  
**정확하고 안정적인 후처리를 목표로 하는 모드**입니다.

Tampermonkey가 기록하는:

- 강의 시작 시각  
- 강의 종료 시각  
- donut index  
- chapter  
- lecture  
- fullText  

정보를 포함한 **CSV 파일**을 기준으로

👉 전체 녹음 / 전체 캡처를  
👉 강의별로 자동 분리하여 저장합니다.

---

### ✔ 동작 방식

1️⃣ Tampermonkey가 CSV 생성

```
startTime,endTime,donut,chapter,lecture,fullText
```

2️⃣ B탭에서
- 전체 세션 녹음(webm) 1개 준비
- 전체 캡처 이미지 준비

3️⃣ CSV 기준으로:
- webm 오디오 분리
- 캡처 시간 기준 분리
- 강의별 PDF 생성

---

### ✔ 오디오(webm) 처리

입력:
```
full_session.webm
```

출력:
```
114 - Ch 5 - 03. RAG.webm
114 - Ch 5 - 04. Retrieval.webm
```

---

### ✔ 이미지 → PDF 처리

캡처 파일명에 반드시 시각 포함

예:
```
session1_20250107_102130.webp
```

이미지 촬영 시간 ∈ 강의 구간이면  
→ 해당 강의 폴더로 묶음  
→ PDF 생성

```
114 - Ch 5 - 03. RAG.pdf
```

---

### ✔ UI 요구사항

```
[ 제목감지 일괄 분할모드 (CSV) ON / OFF ]

[ CSV 파일 선택 ]
[ 전체 webm 파일 선택 ]
[ 캡처 폴더 선택 ]

[ 🔄 일괄 처리 실행 버튼 ]
```

상태 표시:
- CSV 로드 성공 여부
- 강의 구간 개수
- 처리된 webm 개수
- 생성된 PDF 개수
- 실패/누락 항목 로그

---

### ✔ 장점

- 정확도 최고
- 매우 안정적
- 실수/누락 최소화
- 나중에도 재처리 가능

---

### ❗ 전제 조건

- Tampermonkey CSV 기록 필수
- 캡처 파일 시간 정보 필수

---

---

# 🔎 4️⃣ 두 모드 비교

| 항목 | 제목감지 자동 분할 (클립보드) | CSV 일괄 분리 |
|------|-------------------------------|----------------|
| 처리 방식 | 실시간 처리 | 후처리 일괄 분리 |
| 판단 기준 | 클립보드 문자열 변화 | CSV 시간 데이터 |
| 정확도 | 중간~높음 | 매우 높음 |
| 안정성 | 중간 | 매우 높음 |
| 편의성 | 매우 좋음 | 처리 한 번 필요 |
| 실패 리스크 | 클립보드 이슈 | CSV 없으면 불가 |

---

## 5️⃣ 공통 요구사항

- 오디오 형식: webm 고정  
- 캡처 형식: WebP 유지  
- 파일명 불가 문자 자동 제거  
- 처리 로그 표시  
- 오류 발생 시 명확한 안내 제공  
- 실시간 로그창에 전체 진행사항 자세히 제공공

---

## 🎯 최종 목표

- “실시간 편의성”과 “정확한 후처리 안정성” 모두 제공  
- 사용자 선택권 보장  
- 완전 자동화된 강의 기록 시스템 구축  
- 녹음·기록·정리 과정의 부담 최소화  

---

본 PRD 기준으로 개발 진행 부탁드립니다.
